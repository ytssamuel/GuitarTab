<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å‹æ–¼å¡µåœŸ - å’Œå¼¦å³æ™‚è½‰èª¿å·¥å…·</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    pre { background: #fff; padding: 1em; border: 1px solid #ccc; white-space: pre-wrap; }
    .controls { margin-bottom: 1em; }
    button { margin: 2px; padding: 6px 12px; }
    h2 { margin-top: 1em; }
  </style>
</head>
<body>

<h1>ğŸ¸ å‹æ–¼å¡µåœŸ å’Œå¼¦è­œè½‰èª¿å·¥å…·</h1>

<div class="controls">
  <h2>ğŸ¼ é¸æ“‡èª¿æ€§ (Key):</h2>
  <div id="key-buttons"></div>

  <h2>ğŸ¸ Capo ä½ç½®:</h2>
  <div id="capo-buttons"></div>
</div>

<h2>å’Œå¼¦è­œ:</h2>
<pre id="chord-display"></pre>

<script>
const originalKey = 'G'; // å’Œå¼¦è­œåŸå§‹èª¿
let currentKey = 'G';
let capo = 0;

const keys = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
const chordMap = {
  'C':0,'C#':1,'Db':1,'D':2,'D#':3,'Eb':3,'E':4,'F':5,'F#':6,'Gb':6,'G':7,'G#':8,'Ab':8,'A':9,'A#':10,'Bb':10,'B':11
};

function transposeChord(chord, diff) {
  let match = chord.match(/^([A-G][b#]?)(.*)$/);
  if (!match) return chord;
  let [_, root, suffix] = match;
  let idx = (chordMap[root] + diff + 12) % 12;
  return keys[idx] + suffix;
}

function transposeChordSheet(sheet, fromKey, toKey, capoShift) {
  let diff = (chordMap[toKey] - chordMap[fromKey] - capoShift + 12) % 12;
  return sheet.replace(/\b([A-G][b#]?)(maj7|sus4|m|min|dim|aug|add\d*|\d*|)\b/g, (m, root, suffix) => {
    return transposeChord(root + suffix, diff);
  });
}

const chordSheet = `
Key  : â™­B (AG: G)   Capo : 3

[Pre]
    G  |  D  

[Verse 1]
   G          Em
æˆ‘åƒ¹å€¼å‹éæ–¼å¡µåœŸ
          C      D   G       
ç•¶ä½ ç‚ºæˆ‘è€Œä¾†ï¼Œå¿…æ¶ˆå¤±ç„¡å½¢
   G          Em
å› ä¿¡åŸºç£æˆ‘ä»Šç«™ç«‹
        C      D    G
ç•¶ä½ æ³¨è¦–æˆ‘ï¼Œä¸€åˆ‡éƒ½æ›´æ–°

[Chorus]
      Cmaj7  Dsus4    G 
æˆ‘æ˜¯ç«ç‘°ï¼Œä½ å—è‹¦çš„å–œæ‚…
      Cmaj7  Dsus4     G      
æˆ‘æ·±çŸ¥é“ï¼Œä½ å› æˆ‘å‹•å¿ƒæ­¡æ„‰
    Cmaj7 Dsus4     Em
ç•¶æˆ‘çš„å¿ƒå››é¢é­å—è²¬é›£
           Cmaj7    Dsus4  G
ä½ ä»¥çœŸç†è­·åº‡æˆ‘ï¼Œæ˜¯ä½ çš„ç«ç‘°

[Verse 2]
   G          Em
ç”Ÿå‘½ä¸å†æ†‘çœ¼æ‰€è¦‹
          C      D   G 
æˆ‘ç¾èˆ‡ä»–åˆä¸€ï¼Œå½°é¡¯åœ¨ä»–è£¡
   G          Em
æˆ‘çš„æ„›ç‚ºä»–å¯¶è²´çæƒœ
          C      D   G 
ä¸»æˆ‘ç”¨çœ¼ä¸€çœ‹ï¼Œå¥ªäº†ä½ çš„å¿ƒ

[Tag 1] x4
      G          D
æˆ‘æ˜¯ç«ç‘°ï¼Œè°·ä¸­ç™¾åˆèŠ±
     Em       C
å±¬æ–¼ä½ ï¼Œæˆ‘ç”šç¾éº—

[Tag 2] x2
 G          D  
å©šç¦®å³å°‡å°±è¦ä¾†è‡¨
              Em        C
å› æˆ‘å°±æ˜¯ç‚ºäº†ç¾”ç¾Š çš„å©šå¨¶è€Œæ´»
`;

function renderChordSheet() {
  const updated = transposeChordSheet(chordSheet, originalKey, currentKey, capo);
  document.getElementById("chord-display").textContent = updated;
}

function createButtons(containerId, values, clickHandler) {
  const container = document.getElementById(containerId);
  values.forEach(val => {
    const btn = document.createElement("button");
    btn.textContent = val;
    btn.onclick = () => {
      clickHandler(val);
      renderChordSheet();
    };
    container.appendChild(btn);
  });
}

// åˆå§‹åŒ–æŒ‰éˆ•
createButtons("key-buttons", keys, key => currentKey = key);
createButtons("capo-buttons", Array.from({length: 9}, (_, i) => i), c => capo = parseInt(c));

// åˆå§‹æ¸²æŸ“
renderChordSheet();
</script>

</body>
</html>
