<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½‰èª¿åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-case { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .test-input { font-weight: bold; color: #0066cc; }
        .test-output { color: #006600; }
        .test-expected { color: #666; }
    </style>
</head>
<body>
    <h1>ğŸ¸ è½‰èª¿åŠŸèƒ½æ¸¬è©¦</h1>
    <p>æ¸¬è©¦ä¿®æ­£å¾Œçš„è½‰èª¿åŠŸèƒ½ï¼Œé©—è­‰bugæ˜¯å¦å·²è§£æ±º</p>
    
    <div id="test-results"></div>

    <script type="module">
        import { transposeChordSheet, transposeChord } from '../assets/js/modules/transpose.js';

        const testCases = [
            // æ¸¬è©¦è¤‡é›œå’Œå¼¦è½‰æ›
            {
                name: "è¤‡é›œå’Œå¼¦è½‰æ› - Bm7æ‡‰è©²è¢«æ­£ç¢ºè½‰æ›",
                input: "Bm7 Cmaj7 Dsus4 Em7",
                fromKey: "C",
                toKey: "D", 
                capo: 0,
                expected: "C#m7 Dmaj7 Esus4 F#m7" // å‡äºŒåº¦
            },
            {
                name: "è¤‡é›œå’Œå¼¦è½‰æ› - åŒ…å«æ–œç·šå’Œå¼¦",
                input: "Am7 Dm7 G7 C/E",
                fromKey: "C",
                toKey: "G",
                capo: 0,
                expected: "Em7 Am7 D7 G/B" // å‡äº”åº¦
            },
            {
                name: "ç­‰éŸ³ç°¡åŒ– - é¿å…#bæƒ…æ³",
                input: "C D E F G A B",
                fromKey: "C",
                toKey: "Db", 
                capo: 0,
                expected: "Db Eb F Gb Ab Bb C" // å‡åŠåº¦
            },
            {
                name: "è¤‡åˆå’Œå¼¦æ¸¬è©¦",
                input: "Cadd9 Gsus2 Am11 F6",
                fromKey: "C",
                toKey: "E",
                capo: 0,
                expected: "Eadd9 Bsus2 C#m11 A6" // å‡å››åº¦
            },
            {
                name: "æ¸›å’Œå¼¦èˆ‡å¢å’Œå¼¦",
                input: "Cdim Daug Em7b5",
                fromKey: "C", 
                toKey: "F",
                capo: 0,
                expected: "Fdim Gaug Am7b5" // å‡äº”åº¦
            },
            {
                name: "å¯¦éš›æ­Œæ›²æ¸¬è©¦ - åŒ…å«è¤‡é›œå’Œå¼¦",
                input: `[Verse]
G          Em7
æˆ‘åƒ¹å€¼å‹éæ–¼å¡µåœŸ
      Cmaj7    D7   G       
ç•¶ä½ ç‚ºæˆ‘è€Œä¾†ï¼Œå¿…æ¶ˆå¤±ç„¡å½¢
   Bm7        Em7
å› ä¿¡åŸºç£æˆ‘ä»Šç«™ç«‹
        Am7      D7    G
ç•¶ä½ æ³¨è¦–æˆ‘ï¼Œä¸€åˆ‡éƒ½æ›´æ–°`,
                fromKey: "G",
                toKey: "A",
                capo: 0,
                expected: `[Verse]
A          F#m7
æˆ‘åƒ¹å€¼å‹éæ–¼å¡µåœŸ
      Dmaj7    E7   A       
ç•¶ä½ ç‚ºæˆ‘è€Œä¾†ï¼Œå¿…æ¶ˆå¤±ç„¡å½¢
   C#m7        F#m7
å› ä¿¡åŸºç£æˆ‘ä»Šç«™ç«‹
        Bm7      E7    A
ç•¶ä½ æ³¨è¦–æˆ‘ï¼Œä¸€åˆ‡éƒ½æ›´æ–°`
            }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let passCount = 0;
            let totalCount = testCases.length;

            testCases.forEach((testCase, index) => {
                const result = transposeChordSheet(
                    testCase.input, 
                    testCase.fromKey, 
                    testCase.toKey, 
                    testCase.capo
                );
                
                const passed = result.trim() === testCase.expected.trim();
                if (passed) passCount++;

                const testDiv = document.createElement('div');
                testDiv.className = `test-case ${passed ? 'pass' : 'fail'}`;
                testDiv.innerHTML = `
                    <h3>æ¸¬è©¦ ${index + 1}: ${testCase.name} ${passed ? 'âœ…' : 'âŒ'}</h3>
                    <div class="test-input">è¼¸å…¥: ${testCase.fromKey} â†’ ${testCase.toKey} (Capo: ${testCase.capo})</div>
                    <div><strong>åŸæ–‡:</strong><br><pre>${testCase.input}</pre></div>
                    <div class="test-output"><strong>å¯¦éš›çµæœ:</strong><br><pre>${result}</pre></div>
                    <div class="test-expected"><strong>é æœŸçµæœ:</strong><br><pre>${testCase.expected}</pre></div>
                `;
                resultsDiv.appendChild(testDiv);
            });

            // é¡¯ç¤ºç¸½çµ
            const summaryDiv = document.createElement('div');
            summaryDiv.style.cssText = 'margin-top: 20px; padding: 15px; background-color: #e7f3ff; border-radius: 5px;';
            summaryDiv.innerHTML = `<h2>æ¸¬è©¦ç¸½çµ: ${passCount}/${totalCount} é€šé ${passCount === totalCount ? 'ğŸ‰' : 'âš ï¸'}</h2>`;
            resultsDiv.insertBefore(summaryDiv, resultsDiv.firstChild);
        }

        // åŸ·è¡Œæ¸¬è©¦
        runTests();
    </script>
</body>
</html>
